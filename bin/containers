#!/usr/bin/bash

### Create a container for apps that don't require codecs
install_apps(){
    sudo dnf install -y https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm
    sudo dnf install -y vim-enhanced wget

    curl -L -o proton-mail.rpm $PROTON_MAIL
    curl -L -o proton-pass.rpm $PROTON_PASS
    curl -L -o proton-authenticator.rpm $PROTON_AUTH

    sudo dnf install -y *.rpm
    rm *.rpm
    
    # cloud apps
    distrobox-export --app proton-pass
    distrobox-export --app proton-mail
    distrobox-export --app proton-authenticator
}

install_tooling(){
    sudo dnf install -y https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm
    printf "[gitlab.com_paulcarroty_vscodium_repo]\nname=download.vscodium.com\nbaseurl=https://download.vscodium.com/rpms/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://gitlab.com/paulcarroty/vscodium-deb-rpm-repo/-/raw/master/pub.gpg\nmetadata_expire=1h\n" | sudo tee -a /etc/yum.repos.d/vscodium.repo
    sudo dnf update -y
    sudo dnf group install -y rpm-development-tools development-tools c-development
    sudo dnf install -y kate kommit python3-idle gh git-cola vim-enhanced python3-lsp-server python3-devel \
    ShellCheck codium meld zenity
}

install_packages(){
    if [ "$1" == "apps" ]
    then
        install_apps
    elif [ "$1" == "tooling" ]
    then
        install_tooling
    else 
        echo ""
    fi
}

if [ -z "$container" ]
then
    echo "Not in a container. Closing."
elif [ -n "$container" ]
then
    install_packages "$1"
else 
    echo ""
fi